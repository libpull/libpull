include ../../Makefile.conf
LOGGER_VERBOSITY ?= 4

CONTIKI_PROJECT = test
all: $(CONTIKI_PROJECT)

ROOTDIR=../../../..
BOARDDIR = ../../target/$(TARGET)/$(BOARD)
LIBPULL += $(ROOTDIR)/src/network $(ROOTDIR)/src/common $(ROOTDIR)/src/memory
LIBPULL += $(ROOTDIR)/src/security $(BOARDDIR)
LIBPULL_SOURCEFILES = $(notdir $(shell find $(LIBPULL) -maxdepth 1 \( -name '*.c' ! -name 'linker_script.c' \) ))
LIBPULL_INCLUDES = -I$(ROOTDIR)/include -I$(BOARDDIR)
CFLAGS += -DSIMPLE_MANIFEST -DLOGGER_VERBOSITY=$(LOGGER_VERBOSITY)

#Â Add libpull to the build
PROJECTDIRS += $(LIBPULL)
PROJECT_SOURCEFILES += $(LIBPULL_SOURCEFILES)
CFLAGS += $(LIBPULL_INCLUDES) 

CFLAGS += -DOTA=1 -DPAGE_SIZE=$(PAGE_SIZE)
CFLAGS += -DBOOTLOADER_START_PAGE=$(BOOTLOADER_START_PAGE)
CFLAGS += -DBOOTLOADER_END_PAGE=$(BOOTLOADER_END_PAGE)
CFLAGS += -DIMAGE_START_PAGE=$(IMAGE_START_PAGE)
CFLAGS += -DIMAGE_END_PAGE=$(IMAGE_END_PAGE)
CFLAGS += -DMANIFEST_SIZE=$(MANIFEST_SIZE)
CFLAGS += -DBOOTLOADER_CTX_START_OFFSET=$(BOOTLOADER_CTX_START_OFFSET)
CFLAGS += -DBOOTLOADER_CTX_END_OFFSET=$(BOOTLOADER_CTX_END_OFFSET)
CFLAGS += -DRECOVERY_IMAGE=$(RECOVERY_IMAGE)
CFLAGS += -DINITIAL_MEMORY_OFFSET=$(INITIAL_MEMORY_OFFSET)

CONTIKI = ../../ext/contiki-ng
include $(CONTIKI)/Makefile.include
